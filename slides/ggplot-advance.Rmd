---
title: "GGplot"
subtitle: "Advanced"
author: "Philip Leftwich"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: ["default", "css/my-theme.css", "css/my-fonts.css"]
    seal: false
    lib_dir: libs
    nature:
      ratio: '16:9'
      highlightStyle: dracula
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE, message = FALSE, warning=FALSE}

options(htmltools.dir.version = FALSE,
        eval = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE, fig.retina = 3, fig.asp = 0.8, fig.width = 7, out.width = "120%")
library(tidyverse)
library(gt)
library(gtExtras)
library(palmerpenguins)
library(tidyverse)
library(here)
library(hexbin)
library(gganimate)
library(usethis)
library(scico)
library(scales)
beaches <- read_csv(here("data","sydneybeaches3.csv"))
```





class: title-slide, left, top

# `r rmarkdown::metadata$title`

## `r rmarkdown::metadata$subtitle`

### `r rmarkdown::metadata$author`

<br>



<span style='color:white;'>Slides released under</span> [CC-BY 2.0](https://creativecommons.org/licenses/by/2.0/)&nbsp;&nbsp;`r fontawesome::fa("creative-commons", "white")``r fontawesome::fa("creative-commons-by", "white")` ]   

<div style = "position: absolute;top: 0px;right: 0px;"><img src="images/logo.png" alt="The hex logo for plumbertableau package" width="500"></img></div>



---

# Data visualisation


- Dataset from Danielle Navarro

<!-- *********** NEW SLIDE ************** -->
---


```{r beachesdata, eval=TRUE, message=FALSE}
# load data
beaches <- read_csv(here("data","sydneybeaches3.csv")) 

# show data
beaches
```



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

A simple plot

```{r, eval=FALSE, message = FALSE}
ggplot(
  beaches, 
  aes(temperature, rainfall)
) + 
geom_point()
```

- A little verbose?
- Not the prettiest plot?
- Why is it like this?

]

.right-plot[


```{r introplot, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(beaches, aes(temperature, rainfall)) + geom_point()
```

]




<!-- *********** NEW SLIDE ************** -->
---
class: split-50 bg-main1

.column.bg-main1[.content.vtop.center[

.pull.left[.pad1[.font2[

.center[
# ggplot2 is...
]
<br>

## A grammar...

- grammars compose & reuse small parts
- complex structures from simpler units

## ...of graphics

- uses the "painters model"
- a plot is built in layers
- each layer is drawn on top of the last

]]]
]]

.column.bg-main3[.content.vmiddle.center[



]]







<!-- *********** NEW SLIDE ************** -->
---
class: split-50 bg-main1

.column.bg-main1[.content.vtop.center[

.left-code[

A blank canvas

```{r, eval=FALSE, message = FALSE}
ggplot()
```

]

.right-plot[

```{r blankcanvas, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE}
ggplot() 
```

]





<!-- *********** NEW SLIDE ************** -->
---
class: split-50 bg-main1

.left-code[

Specify the data

```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches #<<
)
```

]

.right-plot[

```{r stillblankcanvas, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE}
ggplot(
  data = beaches #<<
) 
```

]


---


.left-code[

```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(      #<<
    x = temperature, #<<
    y = rainfall       #<<
  )                   #<<
)
```



- .orange[x]-axis location
- .orange[y]-axis location
- .orange[colour] of marker
- .orange[fill] of a marker
- .orange[shape] of a marker, etc.

]

.right-plot[


```{r aesthetics, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
)
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Add a plot .orange[layer]

```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point() #<<
```

- the .orange[points]
- the .orange[lines]
- the .orange[histograms]
- etc

]

.right-plot[

```{r add_layer, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point() #<<
```

]



<!-- *********** NEW SLIDE ************** -->
---


.left-code[

Add layer-specific parameters
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(size = 3) #<<
```

]

.right-plot[


```{r add_fixedaesthetic, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(size = 3) #<<
```

]






<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Add layer-specific mappings
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name), #<<
  size = 3
)   
```

]

.right-plot[


```{r add_layeraesthetic, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name), #<<
  size = 3
) 
```

]






<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Add more layers to the plot
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name),
  size = 3
) + 
geom_rug() #<<
```

]

.right-plot[


```{r two_layers, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name), 
  size = 3
) + 
geom_rug()
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Split into .orange[facets]
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name), 
  size = 2
) + 
geom_rug() + 
facet_wrap(vars(season_name)) #<<
```

]

.right-plot[

```{r add_facets, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name), 
  size = 2
) + 
geom_rug() + 
facet_wrap(vars(season_name)) #<<
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Remove an unwanted legend?
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name), 
  size = 2,
  show.legend = FALSE #<<
) + 
geom_rug() + 
facet_wrap(vars(season_name)) 
```

]

.right-plot[

```{r remove_legend, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name), 
  size = 2,
  show.legend = FALSE #<<
) + 
geom_rug() + 
facet_wrap(vars(season_name)) 
```

]


<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Modify the .orange[theme]
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name), 
  size = 2,
  show.legend = FALSE 
) + 
geom_rug() + 
facet_wrap(vars(season_name)) + 
theme_bw() #<<
```

]

.right-plot[

```{r add_theme, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name), 
  size = 2,
  show.legend = FALSE #<<
) +
geom_rug() + 
facet_wrap(vars(season_name)) + 
theme_bw() 
```

]







<!-- *********** NEW SLIDE ************** -->
---

.left-code[

```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall)) + 
geom_point(
  mapping = aes(colour = season_name), 
  size = 2,
  show.legend = FALSE) +  
geom_rug() + 
facet_wrap(vars(season_name)) + 
theme_bw() +
labs( #<<
  title = "Sydney weather by season", #<<
  subtitle = "Data from 2013 to 2018", #<<
  x = "Temperature (Celsius)", #<<
  y = "Rainfall (mm)" #<<
) #<<

```

]

.right-plot[

```{r add_titles, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature, 
    y = rainfall
  ) 
) + 
geom_point(
  mapping = aes(colour = season_name), 
  size = 2,
  show.legend = FALSE
) +
geom_rug() + 
facet_wrap(vars(season_name)) + 
theme_bw() + 
labs( #<<
  title = "Sydney weather by season", #<<
  subtitle = "Data from 2013 to 2018", #<<
  x = "Temperature (Celsius)", #<<
  y = "Rainfall (mm)" #<<
) #<<
```

]





<!-- *********** NEW SLIDE ************** -->
---
class: split-50 bg-main1

.column.bg-main1[.content.vtop.center[
.pull.left[.pad1[.font2[
All the ingredients are needed!

- Data
- Aesthetics
- Layers
- Facets
- Theme
- (Coordinates)
- (Scales)

]]]
]]

--

.column.bg-main3[.content.vtop.center[
.pull.left[.pad1[.font2[
So when I type this...
```{r condensed, eval=FALSE}
ggplot(
  beaches, 
  aes(temperature, rainfall)
) + 
geom_point()
```

]]]
]]




<!-- *********** NEW SLIDE ************** -->
---
class: split-50 bg-main1

.column.bg-main1[.content.vtop.center[
.pull.left[.pad1[.font2[
All the ingredients are needed!

- Data
- Aesthetics
- Layers
- Facets
- Theme
- (Coordinates)
- (Scales)

]]]
]]

.column.bg-main3[.content.vtop.center[
.pull.left[.pad1[.font2[
What I get is this...
```{r expanded, eval=FALSE}
ggplot(
  data = beaches, 
  mapping = aes(
    x = temperature, y = rainfall)) + 
layer(
  geom = "point",
  stat = "identity",
  position = "identity") + 
facet_null() +
theme_grey() + 
coord_cartesian() + 
scale_x_continuous() + 
scale_y_continuous()
```

]]]
]]





<!-- *********** NEW SLIDE ************** -->
---


# Aesthetics





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date, #<<
    y = log10(enterococci) #<<
  ) 
) + 
geom_line()
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date, #<<
    y = log10(enterococci) #<<
  ) 
) + 
geom_line()
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

The .orange[colour] can be an aesthetic
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci),
    colour = season_name #<<
  ) 
) + 
geom_line()
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci),
    colour = season_name
  ) 
) + 
geom_line()
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

The .orange[group] aesthetic matters!

```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci),
    colour = season_name,
    group = 1, #<< 
  ) 
) + 
geom_line()
```

]

.right-plot[


```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci),
    colour = season_name,
    group = 1, #<< 
  ) 
) + 
geom_line()
```

]






<!-- *********** NEW SLIDE ************** -->
---

.left-code[


The .orange[group] aesthetic matters!
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci),
    colour = season_name,
    group = month, #<< 
  ) 
) + 
geom_line()
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci),
    colour = season_name,
    group = month, #<< 
  ) 
) + 
geom_line()
```

]

<!-- *********** NEW SLIDE ************** -->
---

.left-code[

The .orange[fill] can be an aesthetic
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = log10(enterococci),
    fill = season_name #<<
  ) 
) + 
geom_histogram() #<<
```

]

.right-plot[


```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = log10(enterococci),
    fill = season_name #<<
  ) 
) + 
geom_histogram() #<<
```

]



<!-- *********** NEW SLIDE ************** -->
---


# Geoms



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Points and lines are "simple" geoms
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci)
  ) 
) + 
geom_line() #<<
```

]

.right-plot[


```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci)
  ) 
) + 
geom_line() #<<
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Points and lines are "simple" geoms
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci)
  ) 
) + 
geom_point() #<<
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci)
  ) 
) + 
geom_point() #<<
```

]




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Geoms can be layered and take parameters
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci)
  ) 
) + 
geom_point(size = 5) + #<<
geom_line(colour = "red") #<<
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci)
  ) 
) + 
geom_point(size = 5) + #<<
geom_line(colour = "red") #<<
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

The order of geoms matters
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci)
  ) 
) + 
geom_line(colour = "red") + #<<
geom_point(size = 5) #<<
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci)
  ) 
) + 
geom_line(colour = "red") + #<<
geom_point(size = 5) #<<
```

]


<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Geoms can have different mappings
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci)) ) + 
geom_line(
  linewidth = 2, 
  colour = "black") + #<<
geom_point(
  mapping = aes(colour = season_name), #<<
  size = 5) 
```

- Must be consistent
- Cannot map .orange[x] to two variables

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci)) ) + 
geom_line(
  linewidth = 2, 
  colour = "black") + #<<
geom_point(
  mapping = aes(colour = season_name), #<<
  size = 5) 
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Geoms come in many varieties...
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = season_name,
    y = log10(enterococci))
  ) + 
geom_boxplot() #<<
```


]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = season_name,
    y = log10(enterococci))
  ) + 
geom_boxplot() #<<
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Geoms come in many varieties...
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = season_name,
    y = log10(enterococci))
  ) + 
geom_violin() #<<
```


]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = season_name,
    y = log10(enterococci))
  ) + 
geom_violin() #<<
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Geoms come in many varieties...
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci))
  ) + 
geom_bin2d() #<<
```


]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci))
  ) + 
geom_bin2d() #<<
```

]





<!-- *********** NEW SLIDE ************** -->
---
.left-code[

Geoms come in many varieties...
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci))
  ) + 
geom_hex() #<<
```


]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci))
  ) + 
geom_hex()
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Geoms come in many varieties...
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci))
  ) + 
geom_density_2d() #<<
```


]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci))
  ) + 
geom_density2d() #<<
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Geoms come in many varieties...
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci))
  ) + 
geom_point() +
geom_smooth() #<<
```


]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci))
  ) + 
geom_point() + 
geom_smooth() #<<
```

]




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Geoms come in many varieties...
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci))
  ) + 
geom_point() +
geom_smooth(method = "lm") #<<
```


]

.right-plot[


```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = date,
    y = log10(enterococci))
  ) + 
geom_point() + 
geom_smooth(method = "lm") #<<
```

]


<!-- *********** NEW SLIDE ************** -->
---


# How are layers structured?


<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Let's create a plot with no layers!
```{r, eval=FALSE, message = FALSE}
p <- ggplot(
  data = beaches,
  mapping = aes(x = temperature)) + 
facet_wrap(vars(season_name)) + 
labs( 
  title = "Sydney temperature, 2013-2018", 
  x = "Temperature (Celsius)", y = "") 

print(p)
```

- The partial plot is stored
- Can add to it as needed
- Useful for programming

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
p <- ggplot(
  data = beaches,
  mapping = aes(x = temperature)) + 
facet_wrap(vars(season_name)) + 
labs( 
  title = "Sydney temperature, 2013-2018", 
  x = "Temperature (Celsius)", y = "") 

print(p)
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Layers can compute things!
```{r, eval=FALSE, message = FALSE}
p + geom_histogram() 
```

- histograms are not "in the data"
- this is computed by the layer...
- (...sort of)

]


.right-plot[

```{r add_histogram, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
p + geom_histogram() 
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Layers can compute things!
```{r, eval=FALSE, message = FALSE}
p1 <- p + geom_histogram() 
p2 <- p + geom_density() 
p2
```


]


.right-plot[

```{r add_density, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
p1 <- p + geom_histogram() 
p2 <- p + geom_density() 
p2
```

]






<!-- *********** NEW SLIDE ************** -->

---

.pull-right[

The layer information... density
```{r, eval=TRUE, message = FALSE}
p2$layers
```

Each layer specifies:
- A .orange[geom]: the graphical object to be drawn
- A .orange[stat]: what "statistic" it is applied to
- A .orange[position]: how it is placed

]

--

.pull-left[

The layer information... histogram
```{r, eval=TRUE, message = FALSE}
p1$layers
```

<br>
- There is hidden complexity!
- Let's dig into this...


]




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Our histogram...
```{r, eval=FALSE, message = FALSE}
p + geom_histogram(
  stat = "bin",
  position = "stack"
) 
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
p + geom_histogram(
  stat = "bin",
  position = "stack"
) 
```

]




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Our histogram...
```{r, eval=FALSE, message = FALSE}
p + stat_bin(
  geom = "bar",
  position = "stack"
) 
```

- It is the same?!
- It is, but don't do this!
- Use geom to make layers
- Use stat to change computation

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
p + stat_bin(
  geom = "bar",
  position = "stack"
) 
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Reverse engineering...
```{r, eval=FALSE, message = FALSE}
p + geom_histogram()
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
p + geom_histogram()
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Reverse engineering...
```{r, eval=FALSE, message = FALSE}
p + geom_bar(
  stat = "bin", 
  position = "stack"
) 
```

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
p + geom_bar(
  stat = "bin",
  position = "stack" 
) 
```

]








<!-- *********** NEW SLIDE ************** -->
---

.left-code[


Making a "dot histogram"
```{r, eval=FALSE, message = FALSE}
p + geom_point(
  stat = "bin", 
  position = "stack" 
) 
```

]

.right-plot[


```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
p + geom_point(
  stat = "bin",
  position = "stack"
)
```

]





<!-- *********** NEW SLIDE ************** -->
---


## [Why are you like this?](https:/cran.r-project.org/web/packages/ggplot2/vignettes/extending-ggplot2.html)

"Unfortunately, due to an early design mistake I called these either stat\_() or geom\_(). A better decision would have been to call them layer\_() functions: that’s a more accurate description because every layer involves a stat and a geom."





<!-- *********** NEW SLIDE ************** -->
---

# Positioning



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

This is not so helpful!
```{r, eval=FALSE, message = FALSE}
f <- ggplot(
  data = beaches,
  mapping = aes(
    x = temperature,
    fill = season_name)
  ) 

f + geom_density()
```

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
f <- ggplot(
  data = beaches,
  mapping = aes(
    x = temperature,
    fill = season_name)
  ) 

f + geom_density()
```

]






<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Let's be clearer...
```{r, eval=FALSE, message = FALSE}
f + geom_density(
  position = "identity",
  alpha = .5
)
```

- Geom: density
- Stat: density
- Position: .orange[identity]

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
f + geom_density(
  position = "identity",
  alpha = .5
)
```

]




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Let's be clearer...
```{r, eval=FALSE, message = FALSE}
f + geom_density(
  position = "stack", #<<
  alpha = .5
)
```

- Geom: density
- Stat: density
- Position: .orange[stack]

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
f + geom_density(
  position = "stack",
  alpha = .5
)
```

]







<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Let's be clearer...
```{r, eval=FALSE, message = FALSE}
f + geom_density(
  position = "fill", #<<
  alpha = .5
)
```

- Geom: density
- Stat: density
- Position: .orange[fill]

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
f + geom_density(
  position = "fill",
  alpha = .5
)
```

]

---

## ggridges

.left-code[

Let's be clearer...
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature,
    y = season_name) #<<
  )  +
  ggridges::geom_density_ridges()
```

- Geom: density
- Stat: density
- Position: .orange[fill]

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = beaches,
  mapping = aes(
    x = temperature,
    y = season_name) #<<
  )  +
  ggridges::geom_density_ridges()
```

]


<!-- *********** NEW SLIDE ************** -->
---

.left-code[

This is not so helpful!
```{r, eval=FALSE, message = FALSE}
g <- ggplot(
  data = beaches,
  mapping = aes(
    x = year,
    y = temperature)
  ) 

g + geom_point()
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
g <- ggplot(
  data = beaches,
  mapping = aes(
    x = year,
    y = temperature)
  ) 

g + geom_point()
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Let's be clearer...
```{r, eval=FALSE, message = FALSE}
g + geom_point(
  position = "identity",
  alpha = .5,
  size = 3
)
```

- Geom: point
- Stat: identity
- Position: .orange[identity]

]

.right-plot[


```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
g + geom_point(
  position = "identity",
  size = 3,
  alpha = .5
)
```

]






<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Let's be clearer...
```{r, eval=FALSE, message = FALSE}
g + geom_point(
  position = "jitter",
  alpha = .5,
  size = 3
)
```

- Geom: point
- Stat: identity
- Position: .orange[jitter]

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
g + geom_point(
  position = "jitter",
  size = 3,
  alpha = .5
)
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Let's be clearer...
```{r, eval=FALSE, message = FALSE}
g + geom_point(
  position = position_jitter( #<<
    width = .1, height = 0), #<<
  alpha = .5,
  size = 3
)
```

- Geom: point
- Stat: identity
- Position: .orange[jitter]

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
g + geom_point(
  position = position_jitter(
    width = .1, height = 0
  ),
  size = 3,
  alpha = .5
)
```

]






<!-- *********** NEW SLIDE ************** -->
---

.left-code[

In fact...
```{r, eval=FALSE, message = FALSE}
g + geom_jitter( #<<
  width = .1, #<<
  height = 0, #<<
  alpha = .5,
  size = 3
)
```

- Geom: point
- Stat: identity
- Position: .orange[jitter]

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
g + geom_jitter(
  width = .1, 
  height = 0,
  size = 3,
  alpha = .5
)
```

]



---

## Beeswarm

.left-code[

```{r, eval = FALSE}
g +
    geom_violin(
    aes(group = year)
  )+
  ggbeeswarm::geom_beeswarm(size = .8)


```

]

.right-plot[


```{r, echo = FALSE}
g +
    geom_violin(
    aes(group = year)
  )+
  ggbeeswarm::geom_beeswarm(size = .8)


```

]



<!-- *********** NEW SLIDE ************** -->
---


# Facetting



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

A cluttered density plot...
```{r, eval=FALSE, message = FALSE}
a <- ggplot(
  data = beaches,
  mapping = aes(
    x = log10(enterococci),
    fill = season_name )
) + geom_density(
  show.legend = FALSE)

print(a)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
a <- ggplot(
  data = beaches,
  mapping = aes(
    x = log10(enterococci),
    fill = season_name )
) + geom_density(show.legend = FALSE)

print(a)
```

]






<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Facetting on a grid...
```{r, eval=FALSE, message = FALSE}
a + facet_grid(
  rows = vars(season_name)
)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
a + facet_grid(
  rows = vars(season_name)
)
```

]








<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Facetting on a grid...
```{r, eval=FALSE, message = FALSE}
a + facet_grid(
  cols = vars(season_name)
)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
a + facet_grid(
  cols = vars(season_name)
)
```

]




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Facetting on a grid...
```{r, eval=FALSE, message = FALSE}
a + facet_grid(
  rows = vars(season_name),
  cols = vars(year)
)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
a + facet_grid(
  rows = vars(season_name),
  cols = vars(year)
)
```

]




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Facetting by wrapping...
```{r, eval=FALSE, message = FALSE}
a + facet_wrap(
  facets = vars(season_name), 
  nrow = 2)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
a + facet_wrap(
  facets = vars(season_name), 
  nrow = 2)
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Facetting by wrapping...
```{r, eval=FALSE, message = FALSE}
a + facet_wrap(
  facets = vars(year, season_name)
)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
a + facet_wrap(
  facets = vars(year, season_name)
)
```

]

<!-- *********** NEW SLIDE ************** -->

---

## ggh4x


.left-code[

Facetting by wrapping...
```{r, eval=FALSE, message = FALSE}
a + 
  ggh4x::facet_nested(~year + season_name)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
a + 
  ggh4x::facet_nested(~year + season_name)

```

]
---


# Scales 





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

A badly scaled plot...
```{r, eval=FALSE, message = FALSE}
r <- ggplot(
  data = beaches,
  mapping = aes(
    x = temperature,
    y = enterococci,
    colour = season_name,
    group = 1)) +
  geom_point()

print(r)
```

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
r <- ggplot(
  data = beaches,
  mapping = aes(
    x = temperature,
    y = enterococci,
    colour = season_name,
    group = 1)) +
  geom_point(
    size = 4, alpha = .8)

print(r)
```

]


<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Better!
```{r, eval=FALSE, message = FALSE}
r + scale_y_continuous(
  name = "Enterococci (cfu/100ml)",
  trans = "log10"
)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
r + scale_y_continuous(
  name = "Enterococci (cfu/100ml)",
  trans = "log10"
)
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Better!
```{r, eval=FALSE, message = FALSE}
r + scale_y_continuous(
  name = "Enterococci (cfu/100ml)",
  trans = "log10",
  labels = scales::number_format(
    digits = 3)
)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
r + scale_y_continuous(
  name = "Enterococci (cfu/100ml)",
  trans = "log10",
  labels = scales::number_format(
    digits = 3)
)
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Even better!
```{r, eval=FALSE, message = FALSE}
r + scale_y_continuous(
  name = "Enterococci (cfu/100ml)",
  trans = "log10",
  labels = scales::number_format(
    digits = 3)
  ) + 
  scale_x_continuous(
    name = "Temperature",
    labels = scales::unit_format(
      suffix = "°C")
  )
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
b <- r + scale_y_continuous(
  name = "Enterococci (cfu/100ml)",
  trans = "log10",
  labels = scales::number_format(
    digits = 3)
  ) + 
  scale_x_continuous(
    name = "Temperature",
    labels = scales::unit_format(
      suffix = "°C")
  )
b
```

]


<!-- *********** NEW SLIDE ************** -->
---

# Scales (colour/fill)




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Now where were we...
```{r, eval=FALSE, message = FALSE}
b
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
b
```

]




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Colour/fill aesthetics have scales
```{r, eval=FALSE, message = FALSE}
b + scale_colour_discrete(
  name = "Season"
)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
b + scale_colour_discrete(
  name = "Season"
)
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Many packages provide scales/palettes
```{r, eval=FALSE, message = FALSE}
b + scico::scale_colour_scico_d(
  name = "Season",
  palette = "lajolla"
)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
b + scico::scale_colour_scico_d(
  name = "Season",
  palette = "lajolla"
)
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Many packages provide scales/palettes
```{r, eval=FALSE, message = FALSE}
b + scico::scale_colour_scico_d(
  name = "Season",
  palette = "bilbao"
)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
b + scico::scale_colour_scico_d(
  name = "Season",
  palette = "bilbao"
)
```


]


<!-- *********** NEW SLIDE ************** -->
--- 

---


.left-code[

Many packages provide scales/palettes
```{r, eval=FALSE, message = FALSE}
b + scale_color_manual(values=c("#999999", 
                                "#E69F00", 
                                "#56B4E9",
                                "purple"))
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
b + scale_color_manual(values=c("#999999", 
                                "#E69F00", 
                                "#56B4E9",
                                "purple"))

```

]


<!-- *********** NEW SLIDE ************** -->
---


# Coordinates




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

(Some preprocessing...)
```{r, eval=TRUE, message = FALSE}
rain <- beaches %>% 
  group_by(
    month, year, season_name
    ) %>%
  summarise(
    rain = mean(rainfall)
  ) %>%
  ungroup() %>%
  pivot_wider(
    names_from = year, 
    values_from = rain
  )
```

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
rain <- beaches %>% 
  group_by(
    month, year, season_name
    ) %>%
  summarise(
    rain = mean(rainfall)
  ) %>%
  ungroup() %>%
  pivot_wider(
    names_from = year, 
    values_from = rain
  )

rain
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

A simple scatterplot
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = rain,
  mapping = aes(
    x = `2013`,
    y = `2017`,
    colour = season_name
  )
) + 
geom_point(size = 5) 
```

]


.right-plot[


```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = rain,
  mapping = aes(
    x = `2013`,
    y = `2017`,
    colour = season_name
  )
) + 
geom_point(size = 5)
```

]




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

A simple scatterplot
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = rain,
  mapping = aes(
    x = `2013`,
    y = `2017`,
    colour = season_name
  )
) + 
geom_point(size = 5) + 
geom_abline( #<<
  slope = 1, #<<
  intercept = 0 #<<
) #<<
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = rain,
  mapping = aes(
    x = `2013`,
    y = `2017`,
    colour = season_name
  )
) + 
geom_point(size = 5) + 
geom_abline(
  slope = 1, 
  intercept = 0
)
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

A simple scatterplot
```{r, eval=FALSE, message = FALSE}
ggplot(
  data = rain,
  mapping = aes(
    x = `2013`,
    y = `2017`,
    colour = season_name
  )
) + 
geom_point(size = 5) + 
geom_abline( 
  slope = 1, 
  intercept = 0 
) + 
coord_cartesian( #<<
  xlim = c(0, 25), 
  ylim = c(0, 25) 
)
```

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
ggplot(
  data = rain,
  mapping = aes(
    x = `2013`,
    y = `2017`,
    colour = season_name
  )
) + 
geom_point(size = 5) + 
geom_abline(
  slope = 1, 
  intercept = 0
) + 
coord_cartesian(
  xlim = c(0, 25), #<<
  ylim = c(0, 25) #<<
)
```

]




---



# Themes



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Here's one from earlier...
```{r, eval=FALSE, message = FALSE}
th <- b + 
  scico::scale_colour_scico_d(
    name = "Season",
    palette = "lajolla")

th
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
th <- b + scico::scale_colour_scico_d(
  name = "Season",
  palette = "lajolla"
)

th
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

The default theme
```{r, eval=FALSE, message = FALSE}
th + theme_grey()
```

]


.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
th + theme_grey()
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Other global themes
```{r, eval=FALSE, message = FALSE}
th + theme_bw()
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
th + theme_bw()
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Other global themes
```{r, eval=FALSE, message = FALSE}
th + theme_void()
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
th + theme_void()
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Customising a theme
```{r, eval=FALSE, message = FALSE}
th + theme(
  plot.background = element_rect(
    fill = "#BA68C8", 
    colour = "#BA68C8"
  ) 
)
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
th + theme(
  plot.background = element_rect(
    fill = "#BA68C8", 
    colour = "#BA68C8"
  ) 
)
```

]




<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Customising a theme
```{r, eval=FALSE, message = FALSE}
u <- th + theme(
  plot.background = element_rect(
    fill = "#BA68C8", 
    colour = "#BA68C8"), 
  panel.background = element_rect(
    fill = "#562457",
    colour = "#562457")
)
u
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
u <- th + theme(
  plot.background = element_rect(
    fill = "#BA68C8", 
    colour = "#BA68C8"),
  panel.background = element_rect(
    fill = "#562457",
    colour = "#562457")
)
u
```

]


<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Customising a theme
```{r, eval=FALSE, message = FALSE}
u <- u + theme(
 legend.background = element_rect(
    fill = "#BA68C8", 
    colour = "#BA68C8"))
u
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
u <- u + theme(
  legend.background  = element_rect(
    fill = "#BA68C8", 
    colour = "#BA68C8"))
u
```

]





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Customising a theme
```{r, eval=FALSE, message = FALSE}
u <- u + theme(
  text = element_text(
    colour = "white",
    size = 18
  ))
u
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
u <- u + theme(
  text = element_text(
    colour = "white",
    size = 18
  ))
u
```

]



<!-- *********** NEW SLIDE ************** -->
---

.left-code[

Customising a theme
```{r, eval=FALSE, message = FALSE}
u <- u + theme(
  axis.text = element_text(
    colour = "white",
    size = 18
  ))
u
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
u <- u + theme(
  axis.text = element_text(
    colour = "white",
    size = 18
  ))
u
```

]




<!-- *********** NEW SLIDE ************** -->
---



Custom theme

```{r, eval=TRUE, message = FALSE}
# custom theme sets defaults for font and size, but these can be changed without changing the function
theme_custom <- function(base_size=12, base_family="serif"){
  theme_classic(base_size = base_size, 
                base_family = base_family,
                )  %+replace%
# update theme minimal 
theme(
  # specify default settings for plot titles - use rel to set titles relative to base size
  plot.title=element_text(size=rel(1.5),
      face="bold",
      family=base_family),
  #specify defaults for axis titles
  axis.title=element_text(
    size=rel(1),
    family=base_family),
  # specify position for y axis title
  axis.title.y=element_text(angle = 90,
                            margin = margin(r = 10, l= 10)),
  # specify position for x axis title
  axis.title.x = element_text(margin = margin(t = 10, b = 10)),
  # set major y grid lines
  panel.grid.major.y = element_line(colour="gray", size=0.5),
  # add axis lines
  axis.line=element_line(),
   # Adding a 0.5cm margin around the plot
  plot.margin = unit(c(0.2, 0.5, 0.5, 0.5), units = , "cm"),    
   # Setting the position for the legend
  legend.position = "none"             
)
  
}
```





<!-- *********** NEW SLIDE ************** -->
---

.left-code[

And so...
```{r, eval=FALSE, message = FALSE}
th + theme_custom()
```

]

.right-plot[

```{r, eval=TRUE, message = FALSE, echo=FALSE, cache=TRUE, warning=FALSE}
th + theme_custom()
```

]















