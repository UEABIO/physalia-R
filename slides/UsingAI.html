<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Advancing in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Philip Leftwich" />
    <meta name="date" content="2024-09-15" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/my-theme.css" type="text/css" />
    <link rel="stylesheet" href="css/my-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">





class: title-slide, left, top

# Advancing in R

## 

### Philip Leftwich

&lt;br&gt;

&lt;span style='color:white;'&gt;Slides released under&lt;/span&gt; [CC-BY 2.0](https://creativecommons.org/licenses/by/2.0/)&amp;nbsp;&amp;nbsp;<svg aria-hidden="true" role="img" viewBox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:white;overflow:visible;position:relative;"><path d="M245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93-22.13 0-33.22 14.61-33.22 43.84 0 23.57 9.21 43.84 33.22 43.84 14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98-22.6 0-73.96-10.32-73.96-77.05 0-58.69 43-77.06 72.63-77.06 30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93-22.14 0-33.22 14.61-33.22 43.84 0 23.55 9.23 43.84 33.22 43.84 14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98-22.69 0-73.96-9.87-73.96-77.05 0-58.67 42.97-77.06 72.63-77.06 30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248 129.93 0 248.44-100.87 248.44-248 0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81 0-105.42 85.43-203.27 203.72-203.27 112.53 0 202.82 89.46 202.82 203.26-.01 121.69-99.68 202.82-202.84 202.82z"/></svg><svg aria-hidden="true" role="img" viewBox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:white;overflow:visible;position:relative;"><path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3 3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7 3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256 0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8 103.2 0 202.8-81.1 202.8-202.8.1-113.8-90.2-203.3-202.8-203.3z"/></svg> ]   

&lt;div style = "position: absolute;top: 0px;right: 0px;"&gt;&lt;img src="images/logo.png" alt="The hex logo for plumbertableau package" width="500"&gt;&lt;/img&gt;&lt;/div&gt;

---

layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;Philip Leftwich - Advancing in R&lt;/span&gt;&lt;/div&gt;

---

class: center, inverse, middle

# Introduction

In this chapter, you'll learn how to use AI to help you identify and fix coding errors. AI's attention to detail can spot missing commas and other common mistakes in code.

AI is generally good at this task, although the more complicated your code, the more likely it is that it will run into trouble. This chapter will give a few examples to help you with your prompt engineering.

---

# Activity 1: Set-up

To reproduce the same errors, let's create a reproducible example by loading some packages and a dataset. 


```r
library(tidyverse)
library(palmerpenguins)
data("penguins")
```

---

# Activity 2: Simple Errors

Often, you can just copy and paste the code and error into an AI tool, and it will figure out that you want it to fix the issue.

Here's a simple error where the wrong function name is used:


```r
ggplot(penguins, aes(x = species)) +
   geom_barchart()
```

```
## Error in geom_barchart(): could not find function "geom_barchart"
```
---

Provide both the code and the error to your AI tool for better results.

![Fixing a simple error](images/gpt-1.png)

---

# Activity 3: Contextual Errors

Sometimes, the error is caused by code further up your script rather than the line where the error occurs.

For example, if you want to create a dataset of penguins from Biscoe Island and calculate their mean body mass, the following code will run but produces `NaN`:


```r
biscoe_penguins &lt;- penguins |&gt; 
  filter(island == "biscoe")

biscoe_penguins %&gt;%
  summarise(mean_mass = mean(body_mass_g))
```

```
## # A tibble: 1 × 1
##   mean_mass
##       &lt;dbl&gt;
## 1       NaN
```
---

![ChatGPT giving its best guess](images/gpt-2.png)


---


# Continue with Contextual Errors

Provide more information about the dataset or preceding code to the AI for better assistance.

There’s a couple of things you can do at this point:

- Give the AI all the code you’ve used so far

- Give the AI more information about the dataset.


---

# Continue with Contextual Errors

Use `summary()`, `str()`, and `ls()` to provide dataset details to the AI.

Run `summary(biscoe_penguins)` and give the AI the output for better context.

If the error persists, check if case sensitivity or other minor mistakes could be the issue.


---

I provided the `summary(penguins)` 

```
      species          island    bill_length_mm  bill_depth_mm   flipper_length_mm  body_mass_g       sex           year     
 Adelie   :152   Biscoe   :168   Min.   :32.10   Min.   :13.10   Min.   :172.0     Min.   :2700   female:165   Min.   :2007  
 Chinstrap: 68   Dream    :124   1st Qu.:39.23   1st Qu.:15.60   1st Qu.:190.0     1st Qu.:3550   male  :168   1st Qu.:2007  
 Gentoo   :124   Torgersen: 52   Median :44.45   Median :17.30   Median :197.0     Median :4050   NA's  : 11   Median :2008  
                                 Mean   :43.92   Mean   :17.15   Mean   :200.9     Mean   :4202                Mean   :2008  
                                 3rd Qu.:48.50   3rd Qu.:18.70   3rd Qu.:213.0     3rd Qu.:4750                3rd Qu.:2009  
                                 Max.   :59.60   Max.   :21.50   Max.   :231.0     Max.   :6300                Max.   :2009  
                                 NA's   :2       NA's   :2       NA's   :2         NA's   :2           
```

```
Summary
Issue: The presence of missing values (NAs) in body_mass_g causes mean() to return NaN.
Solution: Use na.rm = TRUE in the mean() function to exclude missing values from the calculation.
Alternative: Remove rows with missing body_mass_g before calculation if appropriate for your analysis.
```

---

# Activity 4: Incorrect (but Functional) Code

Sometimes, code runs but doesn't perform the intended action.

For example, calculating the average body mass by species and sex:


```r
penguins |&gt; 
  group_by(sex, species) |&gt; 
  summarise(mean_body_mass = sd(body_mass_g, na.rm = TRUE))
```

```
## # A tibble: 8 × 3
## # Groups:   sex [3]
##   sex    species   mean_body_mass
##   &lt;fct&gt;  &lt;fct&gt;              &lt;dbl&gt;
## 1 female Adelie              269.
## 2 female Chinstrap           285.
## 3 female Gentoo              282.
## 4 male   Adelie              347.
## 5 male   Chinstrap           362.
## 6 male   Gentoo              313.
## 7 &lt;NA&gt;   Adelie              477.
## 8 &lt;NA&gt;   Gentoo              338.
```

---

You can ask the AI to help you but you can’t just give it the code and output, you also need to tell it what you intended to do. 
This is a good example of why there is no AI tool that allows you to skip understanding the data you’re working with and knowing what it is you’re trying to do.



![Fixing a functional error](images/gpt-3.png)

---

class: center, middle, inverse

# Questions?


---

# Code Review

- **Does it run?** Can a researcher run it easily? Are complex procedures explained?
- **Is it reproducible?** Do you get the same outputs? Is it straightforward to verify them?
- **Is it auditable?** Is the code organized enough to allow understanding and error detection?
- **Does it follow best practices?** Are there modularizations, meaningful variable names, and appropriate error handling?
- **Is it correct and appropriate?** Does the code do what is intended? Is what is intended correct?

Some steps cannot (and should not) be performed by AI, especially those involving sensitive data or domain knowledge.

---

# Code Comments

Code comments are lines of text within the code that are ignored by the computer but help human readers. In R, comments are added using `#`:


```r
# This is a comment
# Compute the mean of three numbers
mean(c(1,2,3))
```

```
## [1] 2
```

Comments are useful for:

- **Clarification:** Explain what code does.
- **Documentation:** Provide information on how and why certain decisions were made.
- **Debugging:** Help isolate code that may be causing errors.
- **Collaboration:** Communicate with other developers.

For transparency, the above text was written by AI.

---

# Activity 1: Add Comments with AI

Let's start by loading the `palmerpenguins` dataset.


```r
library(tidyverse)
library(palmerpenguins)
data("penguins")
```

You can use AI tools to help add comments to your code. Start with this simple prompt:

&gt; Add comments to this code


```r
penguins_clean &lt;- penguins |&gt; 
  drop_na() |&gt; 
  mutate(across(where(is.factor), as.character)) |&gt; 
  mutate(species_sex = interaction(species, sex, sep = "_"))
```

---

The AI can only tell you what the code is doing, it can’t say why you chose to do that. In this example, we’ve created a new column that combines species and sex but the comment gives us no idea what the rationale was for this. The more complex your analysis, the more crucial it becomes to explain the rationale.

![Adding comments](images/gpt-4.png)

---

# Activity 2: Comment Prompt Engineering


In addition to asking AI to comment your code, you can also ask it to review comments you’ve made yourself. To see how this works with a more complex example, and as an act of masochism, I gave the AI some code I wrote for a publication. The full project repository is [here](https://github.com/Philip-Leftwich/AePUb-promoter-length-/blob/main/scripts/01_import.R) 


![Adding comments](images/gpt-5.png)


---

![Adding comments](images/gpt-6.png)


---

# Writing Code

The best AI platform for writing code is arguably Github Copilot, but we'll use generic platforms for this chapter. If you have access to LinkedIn Learning, the short course [Pair Programming with AI](https://www.linkedin.com/learning/pair-programming-with-ai/) by Morten Rand-Hendriksen is highly recommended.

The key takeaway is that AI is useful but not intelligent. AI doesn't think, reason, or have knowledge; it simply outputs based on patterns.

---

# Activity 1: Set-up

We'll use the `palmerpenguins` dataset again for this exercise:


```r
library(tidyverse)
library(palmerpenguins)
data("penguins")
```

We'll also set up an initial prompt for the AI:

&gt; Act like an expert programmer in R. I want you to help me write code. The code should be commented and use tidyverse. Ask questions about the code before you write it if necessary.

---

# Activity 2: Knowledge is Power

When working with AI, it's helpful to provide as much information as possible about your dataset:

`summary()` provides descriptive statistics:


```r
summary(penguins)
```

```
##       species          island    bill_length_mm  bill_depth_mm  
##  Adelie   :152   Biscoe   :168   Min.   :32.10   Min.   :13.10  
##  Chinstrap: 68   Dream    :124   1st Qu.:39.23   1st Qu.:15.60  
##  Gentoo   :124   Torgersen: 52   Median :44.45   Median :17.30  
##                                  Mean   :43.92   Mean   :17.15  
##                                  3rd Qu.:48.50   3rd Qu.:18.70  
##                                  Max.   :59.60   Max.   :21.50  
##                                  NA's   :2       NA's   :2      
##  flipper_length_mm  body_mass_g       sex           year     
##  Min.   :172.0     Min.   :2700   female:165   Min.   :2007  
##  1st Qu.:190.0     1st Qu.:3550   male  :168   1st Qu.:2007  
##  Median :197.0     Median :4050   NA's  : 11   Median :2008  
##  Mean   :200.9     Mean   :4202                Mean   :2008  
##  3rd Qu.:213.0     3rd Qu.:4750                3rd Qu.:2009  
##  Max.   :231.0     Max.   :6300                Max.   :2009  
##  NA's   :2         NA's   :2
```

`str()` lists variables, their data type, and initial values:


```r
str(penguins)
```

```
## tibble [344 × 8] (S3: tbl_df/tbl/data.frame)
##  $ species          : Factor w/ 3 levels "Adelie","Chinstrap",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ island           : Factor w/ 3 levels "Biscoe","Dream",..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ bill_length_mm   : num [1:344] 39.1 39.5 40.3 NA 36.7 39.3 38.9 39.2 34.1 42 ...
##  $ bill_depth_mm    : num [1:344] 18.7 17.4 18 NA 19.3 20.6 17.8 19.6 18.1 20.2 ...
##  $ flipper_length_mm: int [1:344] 181 186 195 NA 193 190 181 195 193 190 ...
##  $ body_mass_g      : int [1:344] 3750 3800 3250 NA 3450 3650 3625 4675 3475 4250 ...
##  $ sex              : Factor w/ 2 levels "female","male": 2 1 1 NA 1 2 1 2 NA NA ...
##  $ year             : int [1:344] 2007 2007 2007 2007 2007 2007 2007 2007 2007 2007 ...
```

`ls()` provides a list of variables in an object without data types or samples, making it more secure:


```r
ls(penguins)
```

```
## [1] "bill_depth_mm"     "bill_length_mm"    "body_mass_g"      
## [4] "flipper_length_mm" "island"            "sex"              
## [7] "species"           "year"
```

In your AI of choice, input:

&gt; here are the variables in my data set

&gt; ls(penguins)
[1] "bill_depth_mm" "bill_length_mm" "body_mass_g" "flipper_length_mm" "island" "sex" "species" "year"

Copilot may provide analysis suggestions using R:


```r
# Load the tidyverse package
library(tidyverse)

# Assuming your data is in a dataframe called 'penguins'
# Get a summary of each numerical variable
penguins %&gt;%
  summarise(
    Average_Bill_Depth = mean(bill_depth_mm, na.rm = TRUE),
    Average_Bill_Length = mean(bill_length_mm, na.rm = TRUE),
    Average_Body_Mass = mean(body_mass_g, na.rm = TRUE),
    Average_Flipper_Length = mean(flipper_length_mm, na.rm = TRUE)
  )
```

```
## # A tibble: 1 × 4
##   Average_Bill_Depth Average_Bill_Length Average_Body_Mass
##                &lt;dbl&gt;               &lt;dbl&gt;             &lt;dbl&gt;
## 1               17.2                43.9             4202.
## # ℹ 1 more variable: Average_Flipper_Length &lt;dbl&gt;
```

```r
# Distribution of species across islands
penguins %&gt;%
  count(island, species) %&gt;%
  ggplot(aes(x = island, y = n, fill = species)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Distribution of Penguin Species Across Islands",
       x = "Island",
       y = "Count")
```

![](UsingAI_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;

```r
# Explore the relationship between flipper length and body mass
penguins %&gt;%
  ggplot(aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(color = species)) +
  geom_smooth(method = "lm") +
  labs(title = "Relationship Between Flipper Length and Body Mass",
       x = "Flipper Length (mm)",
       y = "Body Mass (g)")
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

```
## Warning: Removed 2 rows containing non-finite outside the scale range
## (`stat_smooth()`).
```

```
## Warning: Removed 2 rows containing missing values or values outside the scale range
## (`geom_point()`).
```

![](UsingAI_files/figure-html/unnamed-chunk-15-2.png)&lt;!-- --&gt;

---

# Activity 3: Writing Code

Let's create a table of descriptive statistics for `body_mass_g` and a histogram:

&gt; Create a table of descriptive statistics for body mass and a histogram of that variable

ChatGPT output:


```r
# Load the tidyverse package
library(tidyverse)

# Load the penguins dataset
data("penguins")

# Summary statistics for body mass
body_mass_summary &lt;- penguins %&gt;%
  summarise(
    Mean = mean(body_mass_g, na.rm = TRUE),
    Median = median(body_mass_g, na.rm = TRUE),
    SD = sd(body_mass_g, na.rm = TRUE),
    Min = min(body_mass_g, na.rm = TRUE),
    Max = max(body_mass_g, na.rm = TRUE)
  )

# Print the summary statistics
print(body_mass_summary)
```

```
## # A tibble: 1 × 5
##    Mean Median    SD   Min   Max
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
## 1 4202.   4050  802.  2700  6300
```

```r
# Create a histogram of body mass
ggplot(penguins, aes(x = body_mass_g)) +
  geom_histogram(fill = "skyblue", color = "black", bins = 20) +
  labs(
    title = "Distribution of Body Mass",
    x = "Body Mass (g)",
    y = "Frequency"
  ) +
  theme_minimal()
```

```
## Warning: Removed 2 rows containing non-finite outside the scale range
## (`stat_bin()`).
```

![](UsingAI_files/figure-html/unnamed-chunk-16-1.png)&lt;!-- --&gt;

---

# Conclusions and Musings

Using AI to write code can speed up routine tasks, but it's essential to check AI output for accuracy and ensure that it aligns with your goals. 

**Remember:** AI doesn't replace expertise—it complements it. Always review and understand the code you use.

- Provide context
- Tell it to assume an identity or profession
- Keep it on track
- Tell it to re-read and explain prompts
- Tell it style preferences (e.g. tidyverse)


---

class: center, middle, inverse

# Questions?


---

# Code Review

![Adding comments](images/m_jeb14230-fig-0001.jpeg)


# Code Review

Making coding errors is normal and regular review could help correct many of these mistakes

In [this paper](https://academic.oup.com/jeb/article/36/10/1347/7577476?login=false) the process of code review is laid out

![Adding comments](images/m_jeb14230-fig-0002.jpeg)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "dracula",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
